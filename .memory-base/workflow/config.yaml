# AI Agents Workflow Configuration

# MCP серверы
mcp_servers:
  context7:
    description: "Актуальная документация библиотек"
    tools:
      - mcp__context7__resolve-library-id
      - mcp__context7__get-library-docs

# Агенты и их роли
agents:
  task-creator:
    prompt: prompts/roles/task-creator.md
    description: "Анализирует запрос, исследует кодовую базу, создаёт task.md"
    tools:
      - Read
      - Write
      - Glob
      - Grep
      - mcp__context7__resolve-library-id
      - mcp__context7__get-library-docs

  architect:
    prompt: prompts/roles/architect.md
    description: "Проектирует архитектуру, разбивает задачи на подзадачи"
    tools:
      - Read
      - Glob
      - Grep
      - mcp__context7__resolve-library-id
      - mcp__context7__get-library-docs

  coder:
    prompt: prompts/roles/coder.md
    description: "Пишет код по спецификации"
    tools:
      - Read
      - Edit
      - Write
      - Glob
      - Grep
      - mcp__context7__resolve-library-id
      - mcp__context7__get-library-docs

  reviewer:
    prompt: prompts/roles/reviewer.md
    description: "Проверяет код на качество, безопасность, соответствие стандартам"
    tools:
      - Read
      - Glob
      - Grep
      - mcp__context7__resolve-library-id
      - mcp__context7__get-library-docs

  tester:
    prompt: prompts/roles/tester.md
    description: "Пишет и запускает тесты"
    tools:
      - Read
      - Edit
      - Write
      - Bash
      - Glob
      - Grep
      - mcp__context7__resolve-library-id
      - mcp__context7__get-library-docs

  debugger:
    prompt: prompts/roles/debugger.md
    description: "Анализирует проблемы, находит root cause"
    tools:
      - Read
      - Bash
      - Glob
      - Grep
      - mcp__context7__resolve-library-id
      - mcp__context7__get-library-docs

  docwriter:
    prompt: prompts/roles/docwriter.md
    description: "Пишет и обновляет документацию"
    tools:
      - Read
      - Edit
      - Write
      - Glob

# Типовые pipelines
pipelines:
  feature:
    description: "Новая функциональность"
    stages:
      - architect
      - coder
      - reviewer
      - tester
      - docwriter

  bugfix:
    description: "Исправление бага"
    stages:
      - debugger
      - coder
      - tester

  refactor:
    description: "Рефакторинг"
    stages:
      - architect
      - coder
      - reviewer
      - tester

  docs:
    description: "Только документация"
    stages:
      - docwriter

  hotfix:
    description: "Срочное исправление"
    stages:
      - coder
      - tester

# Настройки задач
tasks:
  id_prefix: "TSK"
  directories:
    active: tasks/active
    completed: tasks/completed
    failed: tasks/failed

# Форматы файлов результатов
output:
  format: markdown
  frontmatter: yaml
  required_fields:
    - agent
    - task_id
    - status
    - created_at
  optional_fields:
    - next
    - files_changed
    - blockers

# Статусы
statuses:
  - pending
  - in_progress
  - completed
  - failed
  - blocked

# Параллельное выполнение
parallel_execution:
  enabled: true
  description: |
    Supervisor может запускать несколько одинаковых агентов параллельно
    для независимых подзадач. Это ускоряет выполнение, когда задачи
    не имеют зависимостей между собой.

  rules:
    # Когда можно запускать параллельно
    - condition: "Подзадачи не изменяют одни и те же файлы"
    - condition: "Подзадачи не зависят от результатов друг друга"
    - condition: "Каждая подзадача имеет чёткую границу (свои файлы/модули)"

    # Когда нельзя
    - restriction: "Подзадачи изменяют общий файл"
    - restriction: "Результат одной подзадачи нужен для другой"
    - restriction: "Есть shared state или конфликтующие импорты"

  # Как использовать
  usage:
    supervisor_syntax: |
      Supervisor запускает агентов через Task tool с несколькими вызовами
      в одном сообщении:

      Task(coder, "Подзадача 1: создать API client")
      Task(coder, "Подзадача 2: создать Telegram wrapper")
      Task(coder, "Подзадача 3: создать ComboSelector")

    naming_convention: |
      Результаты параллельных агентов нумеруются с суффиксом:
      02-coder-1.md (API client)
      02-coder-2.md (Telegram wrapper)
      02-coder-3.md (ComboSelector)

    merge_strategy: |
      После завершения всех параллельных агентов:
      1. Supervisor проверяет конфликты
      2. При конфликтах — ручное разрешение
      3. При успехе — переход к следующему stage

  # Рекомендуемые агенты для параллельного запуска
  parallelizable_agents:
    - coder      # разные модули/компоненты
    - tester     # тесты для разных модулей
    - reviewer   # ревью разных частей кода
    - docwriter  # документация разных компонентов

  # Агенты, которые обычно НЕ параллелятся
  sequential_agents:
    - architect   # один архитектурный план
    - debugger    # анализ одной проблемы
    - task-creator # одна задача
